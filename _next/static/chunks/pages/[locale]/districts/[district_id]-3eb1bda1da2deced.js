(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[206],{4475:function(e,o,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[locale]/districts/[district_id]",function(){return t(2731)}])},2731:function(e,o,t){"use strict";t.r(o),t.d(o,{__N_SSG:function(){return x},default:function(){return I}});var n=t(2322),a=t(2784),i=t(2285),s=t(8513),c=t.n(s),l=t(5632),r=t(3562),d=t(6635),u=t(9477),_=t(8174),p=t(6176),m=t(3948),g=t(9723),f=t(7062),h=t(5126),y=t(5522),N=t(2893),k=t(2794);let b=e=>{let{districtId:o}=e,t=(0,p.qr)(e=>e.userId),n=0,i=2e3,s=e=>{switch(e.type){case N.t.MessageType.UPDATE_POSITION:case N.t.MessageType.UPDATE_STATE:let o=[...e.payload.users];d.h.setState({playerPositions:o.filter(e=>{var o;return e.uuid!==(null==c?void 0:null===(o=c.getCurrentUser())||void 0===o?void 0:o.uuid)}).map(e=>({id:e.uuid,position:new u.Pa4(e.x,0,e.y)}))});break;case N.t.MessageType.CONNECTION_LOST:console.log("Connection with District Room lost");return}},c=(0,p.qr)(e=>e.socketLink),l=()=>{try{let e=c.joinDistrictRoom(y.R.RoomName.DISTRICTROOM,{metadata:{districtId:o},uuid:t,accessToken:"SuperSecretPWord"},s);e.then(e=>e).then(e=>{}).catch(e=>{console.log("Unable to connect to district room. Error:",e)})}catch(e){console.log("Unable to join a district room. Error:",e),console.log("Reattemping connection..."),n<k.dh?(n++,console.log("Retrying in ".concat(i/1e3," seconds...")),setTimeout(l,i),i*=2):console.log("Could not join district room. Error:",e)}};return(0,a.useEffect)(()=>{if(!c||!t)return;l();let e=new _.default;return e.on("postUpdate",()=>{if(c&&d.h.getState().myPositionChanged){d.h.setState({myPositionChanged:!1});let e=d.h.getState().myPosition;c.setUserPosition(e.x,e.z).catch(()=>{})}}),()=>{e&&e.off("postUpdate"),c&&c.leaveRoom()}},[c,t]),null};var P=t(2182),v=t(1737),E=t(6461),D=t(692),x=!0;function I(e){let{district:o}=e,t=(0,l.useRouter)(),s=(0,r.m_)(),y=a.useRef([]),N=(0,d.EV)(e=>e.streamNodes),k=(0,d.EV)(e=>e.api),x=(0,p.qr)(e=>e.hasMapZoomedIn),I=(0,p.qr)(e=>e.setHasMapZoomedIn),w=(0,p.qr)(e=>e.isApplicationLocked),C=!w,{translate:T}=(0,h.$G)();a.useEffect(()=>{if(C){let e=async()=>{var e;await (0,P.D)(500);let t=g.length,n=(null!==(e=null==o?void 0:o.streamNodes)&&void 0!==e?e:[]).filter(e=>e.status===i.Ie.ONLINE).length,a=null==o?void 0:o.description,c=(0,v.K)(null==o?void 0:o.consoleInfo);s(T("console_map_district_loading",{fallback:"Loading district information..."})),(0,E.xb)(a)||s(a),(0,E.xb)(c)||s(c),s(T("console_map_loading_map",{fallback:"Generating map"})),s(T("console_map_loading nodes",{args:[n,t-n],fallback:"Fetching nodes and connections/traffic"}))};e()}},[C]),(0,a.useEffect)(()=>{if(o){let e=[...g];for(let t=o.streamNodes.length-1;t>=0;t--){let n=e.indexOf(o.streamNodes[t].id);n>-1&&e.splice(n,1)}let t=[...o.streamNodes.map(e=>({id:e.id,position:new u.Pa4,x:0,y:0,displayMode:0,payload:e,isDecrypted:k.isNodeDecrypted(e.id)})),...Array.from({length:g.length-o.streamNodes.length}).map((o,t)=>{let n={id:e[t],position:new u.Pa4,x:0,y:0,displayMode:3,payload:{status:i.Ie.OFFLINE,participants:1,assetFileExtension:"text"},isDecrypted:!1};return n})];d.h.setState({streamNodes:t})}},[o]),(0,a.useEffect)(()=>{let e=new _.default;return e.on("postUpdate",()=>{d.h.getState().streamNodes.forEach((e,o)=>{let t=y.current[o];t&&(t.style.display=0!==e.x&&0!==e.y&&e.displayMode===f.NodeDisplayMode.InsideFrame?"block":"none",t.style.transform="translate3D(".concat(Math.round(e.x-38),"px, ").concat(Math.round(e.y-48),"px,0)"))})}),()=>{e&&e.off("postUpdate")}},[]);let O=e=>{var o,t;s(T("console_map_node_connect",{args:[e.id],fallback:"Connection attempt node ".concat(e.id)}));let n=T("console_map_node_status_".concat((null!==(o=e.payload.status)&&void 0!==o?o:"").toLowerCase()),{fallback:(null!==(t=e.payload.status)&&void 0!==t?t:"").toLowerCase()});s(T("console_map_node_status",{args:[e.id,n],fallback:"Node ".concat(e.id," ").concat(n)}))},L=e=>{switch(e.payload.status){case i.Ie.ONLINE:s(T("console_map_node_connected",{args:[e.id],fallback:"Connection authorised"}));let o=t.asPath.concat("/".concat(e.id));t.push(o);break;case i.Ie.OFFLINE:s(T("console_map_node_unknown",{fallback:"Node status unknown"})),k.trigger.invoke({type:d.zn.ZoomToNode,value:e.id});break;case i.Ie.LOCKED:s(T("console_map_node_locked",{fallback:"Unauthorised connection attempt logged"})),k.trigger.invoke({type:d.zn.ZoomToNode,value:e.id});break;default:s(T("console_map_node_unknown",{fallback:"Node status unknown"}))}},S=e=>{e.type===d.zn.MapZoomCompleted?I(!0):e.type===d.zn.ClickedAmbientNode&&(s(T("console_map_node_unreachable",{fallback:"Node Unreachable - System failure to establish connection for breach protocol"})),setTimeout(()=>{s(T("console_map_node_access_denied",{fallback:"Access denied, data extraction aborted"}))},500))};return(0,a.useEffect)(()=>(k.trigger.add(S),()=>{k.trigger.remove(S)}),[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b,{districtId:null==o?void 0:o.uuid}),(0,n.jsx)("div",{id:"district-nodes",className:c().uiNodes,"data-zoomed-in":x,children:(0,n.jsx)(D.$3,{children:(0,n.jsx)("ul",{children:(null!=N?N:[]).map(e=>(0,n.jsx)(m.V,{logOnClick:o=>{o.stopPropagation(),O(e)},handleRouteOnClick:o=>{o.stopPropagation(),L(e)},ref:e=>y.current.push(e),payload:e.payload,completed:e.isDecrypted},e.id))})})})]})}},8513:function(e){e.exports={districtPage:"DistrictPage_districtPage___9xv7",uiNodes:"DistrictPage_uiNodes__sb6MQ",node:"DistrictPage_node__OCUmL",nodeIcon:"DistrictPage_nodeIcon__Go39o",overFrame:"DistrictPage_overFrame__D3jhk",nodeLabel:"DistrictPage_nodeLabel__QN6OP","connect-lost-background-overlay":"DistrictPage_connect-lost-background-overlay__D_HQa","connection-lost-copy-container":"DistrictPage_connection-lost-copy-container__xLy1z","connection-lost-icon-container":"DistrictPage_connection-lost-icon-container__bHtBe","conection-lost-icon":"DistrictPage_conection-lost-icon__L_mdT"}}},function(e){e.O(0,[520,739,62,374,948,774,888,179],function(){return e(e.s=4475)}),_N_E=e.O()}]);